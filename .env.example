# Allama Environment Configuration
# Copy to .env and fill in secrets: make init

# ---- General ----
LOG_LEVEL=INFO
COMPOSE_PROJECT_NAME=allama
COMPOSE_BAKE=true

# ---- Networking ----
PUBLIC_APP_PORT=80
PUBLIC_APP_URL=http://localhost:${PUBLIC_APP_PORT}
PUBLIC_API_URL=${PUBLIC_APP_URL}/api
INTERNAL_API_URL=http://api:8000

# ---- Caddy reverse proxy ----
BASE_DOMAIN=:${PUBLIC_APP_PORT}
ADDRESS=0.0.0.0

# ---- Frontend (Next.js) ----
# NEXT_PUBLIC_ vars are exposed to the browser
NODE_ENV=development
NEXT_PUBLIC_APP_ENV=development
NEXT_PUBLIC_APP_URL=${PUBLIC_APP_URL}
NEXT_PUBLIC_API_URL=${PUBLIC_API_URL}
# Server-side API calls go container-to-container
NEXT_SERVER_API_URL=${INTERNAL_API_URL}

# ---- Allama core ----
ALLAMA__APP_ENV=development
# Fernet key for encrypting secrets in the DB
# Generate: python3 -c "from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())"
ALLAMA__DB_ENCRYPTION_KEY=your-allama-db-fernet-key
# Service-to-service auth token (openssl rand -hex 32)
ALLAMA__SERVICE_KEY=your-allama-service-key
ALLAMA__EXECUTOR_TOKEN_TTL_SECONDS=900
# Webhook URL signing (openssl rand -hex 32)
ALLAMA__SIGNING_SECRET=your-allama-signing-secret
ALLAMA__API_URL=${INTERNAL_API_URL}
ALLAMA__API_ROOT_PATH=/api
ALLAMA__PUBLIC_APP_URL=${PUBLIC_APP_URL}
ALLAMA__PUBLIC_API_URL=${PUBLIC_API_URL}
ALLAMA__ALLOW_ORIGINS=http://localhost:3000,${PUBLIC_APP_URL}
ALLAMA__DB_SSLMODE=disable

# ---- Postgres ----
ALLAMA__POSTGRES_USER=postgres
ALLAMA__POSTGRES_PASSWORD=postgres
ALLAMA__DB_URI=postgresql+psycopg://${ALLAMA__POSTGRES_USER}:${ALLAMA__POSTGRES_PASSWORD}@postgres_db:5432/postgres

# ---- Auth ----
# First registered user with this email gets superadmin
ALLAMA__AUTH_SUPERADMIN_EMAIL=
# Comma-separated: basic, google_oauth, saml
ALLAMA__AUTH_TYPES=basic,google_oauth
# Restrict sign-ups to these domains (blank = allow all)
ALLAMA__AUTH_ALLOWED_DOMAINS=
ALLAMA__AUTH_MIN_PASSWORD_LENGTH=12
# Google OAuth (leave blank to disable)
OAUTH_CLIENT_ID=
OAUTH_CLIENT_SECRET=
# Password reset / email verification token signing (openssl rand -hex 32)
USER_AUTH_SECRET=your-auth-secret
# SAML SSO (leave blank to disable)
SAML_IDP_METADATA_URL=
SAML_ACCEPTED_TIME_DIFF=3

# ---- Temporal ----
TEMPORAL__CLUSTER_URL=temporal:7233
TEMPORAL__CLUSTER_QUEUE=allama-task-queue
TEMPORAL__CLUSTER_NAMESPACE=default
TEMPORAL__POSTGRES_USER=temporal
TEMPORAL__POSTGRES_PASSWORD=temporal
TEMPORAL__UI_VERSION=latest
# Only needed for Temporal Cloud
TEMPORAL__API_KEY=

# ---- Workflow artefacts ----
# S3 lifecycle rule deletes objects older than this (0 = keep forever)
ALLAMA__WORKFLOW_ARTIFACT_RETENTION_DAYS=30

# ---- MinIO (object storage) ----
MINIO_ROOT_USER=minioadmin
MINIO_ROOT_PASSWORD=minioadmin

# ---- Redis ----
REDIS_URL=redis://redis:6379

# ---- Analytics (cloud only, ignore if self-hosted) ----
NEXT_PUBLIC_POSTHOG_KEY=
NEXT_PUBLIC_POSTHOG_HOST=https://us.i.posthog.com
NEXT_PUBLIC_DISABLE_SESSION_RECORDING=true

# ---- Local registry ----
ALLAMA__LOCAL_REPOSITORY_ENABLED=false
ALLAMA__LOCAL_REPOSITORY_PATH=~/dev/org/internal-registry

# ---- Enterprise feature flags ----
ALLAMA__FEATURE_FLAGS=git-sync,agent-approvals,agent-presets,case-durations,case-tasks
